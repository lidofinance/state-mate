# Triggerable withdrawals upgrade voting verification
# Based on https://github.com/lidofinance/scripts/blob/28e988583d417cca2eaeea9a92430810e234d316/scripts/vote_tw_csm2_mainnet.py
# Items list with verification coverage:

# --- Locator ---
# 1. Update locator implementation ✅ COVERED

# --- VEB ---
# 2. Update VEBO implementation ✅ COVERED
# 3. Call finalizeUpgrade_v2(maxValidatorsPerReport, maxExitRequestsLimit, exitsPerFrame, frameDurationInSec) on VEBO ✅ COVERED
# 4. Grant VEBO role MANAGE_CONSENSUS_VERSION_ROLE to the AGENT ⚠️ PARTIALLY COVERED (role check)
# 5. Bump VEBO consensus version to `4` ✅ COVERED
# 6. Revoke VEBO role MANAGE_CONSENSUS_VERSION_ROLE from the AGENT ⚠️ PARTIALLY COVERED (role check)
# 7. Grant SUBMIT_REPORT_HASH_ROLE on Validator Exit Bus Oracle to the EasyTrack EVM Script Executor ⚠️ PARTIALLY COVERED (role check)

# --- Triggerable Withdrawals Gateway (TWG) ---
# 8. Grant TWG role ADD_FULL_WITHDRAWAL_REQUEST_ROLE to the CS Ejector ⚠️ PARTIALLY COVERED (role check)
# 9. Grant TWG role ADD_FULL_WITHDRAWAL_REQUEST_ROLE to the VEB ⚠️ PARTIALLY COVERED (role check)
# 10. Connect TRIGGERABLE_WITHDRAWALS_GATEWAY to Dual Governance tiebreaker ❌ NOT COVERED

# --- WV ---
# 11. Update WithdrawalVault implementation ✅ COVERED
# 12. Call finalizeUpgrade_v2() on WithdrawalVault ⚠️ PARTIALLY COVERED (version check)

# --- AO ---
# 13. Update Accounting Oracle implementation ✅ COVERED
# 14. Grant AO MANAGE_CONSENSUS_VERSION_ROLE to the AGENT ⚠️ PARTIALLY COVERED (role check)
# 15. Bump AO consensus version to `4` ✅ COVERED
# 16. Revoke AO MANAGE_CONSENSUS_VERSION_ROLE from the AGENT ⚠️ PARTIALLY COVERED (role check)
# 17. Call finalizeUpgrade_v3() on AO ⚠️ PARTIALLY COVERED (version check)

# --- SR ---
# 18. Update SR implementation ✅ COVERED
# 19. Call finalizeUpgrade_v3() on SR ⚠️ PARTIALLY COVERED (version check)
# 20. Grant SR role REPORT_VALIDATOR_EXITING_STATUS_ROLE to ValidatorExitVerifier ⚠️ PARTIALLY COVERED (role check)
# 21. Grant SR role REPORT_VALIDATOR_EXIT_TRIGGERED_ROLE to TWG ⚠️ PARTIALLY COVERED (role check)

# --- Curated Staking Module ---
# 22. Grant APP_MANAGER_ROLE role to the AGENT on Kernel ❌ NOT COVERED
# 23. Update `NodeOperatorsRegistry` implementation ✅ COVERED
# 24. Call finalizeUpgrade_v4 on Curated Staking Module ⚠️ PARTIALLY COVERED (version check)

# --- sDVT ---
# 25. Update `SimpleDVT` implementation ✅ COVERED
# 26. Call finalizeUpgrade_v4 on sDVT ⚠️ PARTIALLY COVERED (version check)
# 27. Revoke APP_MANAGER_ROLE role from the AGENT on Kernel ❌ NOT COVERED

# --- Oracle configs ---
# 28. Grant CONFIG_MANAGER_ROLE role to the AGENT ⚠️ PARTIALLY COVERED (role check)
# 29. Remove NODE_OPERATOR_NETWORK_PENETRATION_THRESHOLD_BP variable from OracleDaemonConfig ❌ NOT COVERED
# 30. Remove VALIDATOR_DELAYED_TIMEOUT_IN_SLOTS variable from OracleDaemonConfig ❌ NOT COVERED
# 31. Remove VALIDATOR_DELINQUENT_TIMEOUT_IN_SLOTS variable from OracleDaemonConfig ❌ NOT COVERED
# 32. Add EXIT_EVENTS_LOOKBACK_WINDOW_IN_SLOTS variable to OracleDaemonConfig ❌ NOT COVERED
# 33. Revoke CONFIG_MANAGER_ROLE role from the AGENT ⚠️ PARTIALLY COVERED (role check)

# --- CSM ---
# 34. Upgrade CSM implementation on proxy ❌ NOT COVERED
# 35. Call `finalizeUpgradeV2()` on CSM contract ❌ NOT COVERED
# 36. Upgrade CSAccounting implementation on proxy ❌ NOT COVERED
# 37. Call `finalizeUpgradeV2(bondCurves)` on CSAccounting contract ❌ NOT COVERED
# 38. Upgrade CSFeeOracle implementation on proxy ❌ NOT COVERED
# 39. Call `finalizeUpgradeV2(consensusVersion)` on CSFeeOracle contract ❌ NOT COVERED
# 40. Upgrade CSFeeDistributor implementation on proxy ❌ NOT COVERED
# 41. Call `finalizeUpgradeV2(admin)` on CSFeeDistributor contract ❌ NOT COVERED
# 42. Revoke CSAccounting role SET_BOND_CURVE_ROLE from the CSM contract ❌ NOT COVERED
# 43. Revoke CSAccounting role RESET_BOND_CURVE_ROLE from the CSM contract ❌ NOT COVERED
# 44. Revoke CSAccounting role RESET_BOND_CURVE_ROLE from the CSM committee ❌ NOT COVERED
# 45. Grant CSM role CREATE_NODE_OPERATOR_ROLE for the permissionless gate ❌ NOT COVERED
# 46. Grant CSM role CREATE_NODE_OPERATOR_ROLE for the vetted gate ❌ NOT COVERED
# 47. Grant CSAccounting role SET_BOND_CURVE_ROLE for the vetted gate ❌ NOT COVERED
# 48. Revoke role VERIFIER_ROLE from the previous instance of the Verifier contract ❌ NOT COVERED
# 49. Grant role VERIFIER_ROLE to the new instance of the Verifier contract ❌ NOT COVERED
# 50. Revoke CSM role PAUSE_ROLE from the previous GateSeal instance ❌ NOT COVERED
# 51. Revoke CSAccounting role PAUSE_ROLE from the previous GateSeal instance ❌ NOT COVERED
# 52. Revoke CSFeeOracle role PAUSE_ROLE from the previous GateSeal instance ❌ NOT COVERED
# 53. Grant CSM role PAUSE_ROLE for the new GateSeal instance ❌ NOT COVERED
# 54. Grant CSAccounting role PAUSE_ROLE for the new GateSeal instance ❌ NOT COVERED
# 55. Grant CSFeeOracle role PAUSE_ROLE for the new GateSeal instance ❌ NOT COVERED
# 56. Grant MANAGE_BOND_CURVES_ROLE to the AGENT ❌ NOT COVERED
# 57. Add Identified Community Stakers Gate Bond Curve ❌ NOT COVERED
# 58. Revoke MANAGE_BOND_CURVES_ROLE from the AGENT ❌ NOT COVERED
# 59. Increase CSM share in Staking Router from 15% to 16% ❌ NOT COVERED

# --- Gate Seals ---
# 60. Revoke PAUSE_ROLE on WithdrawalQueue from the old GateSeal ⚠️ PARTIALLY COVERED (role check)
# 61. Revoke PAUSE_ROLE on ValidatorsExitBusOracle from the old GateSeal ⚠️ PARTIALLY COVERED (role check)
# 62. Grant PAUSE_ROLE on WithdrawalQueue to the new WithdrawalQueue GateSeal ⚠️ PARTIALLY COVERED (role check)
# 63. Grant PAUSE_ROLE on ValidatorsExitBusOracle to the new Triggerable Withdrawals GateSeal ⚠️ PARTIALLY COVERED (role check)
# 64. Grant PAUSE_ROLE on TriggerableWithdrawalsGateway to the new Triggerable Withdrawals GateSeal ⚠️ PARTIALLY COVERED (role check)

# --- ResealManager ---
# 65. Grant PAUSE_ROLE on TriggerableWithdrawalsGateway to ResealManager ⚠️ PARTIALLY COVERED (role check)
# 66. Grant RESUME_ROLE on TriggerableWithdrawalsGateway to ResealManager ⚠️ PARTIALLY COVERED (role check)

# --- EasyTrack ---
# 67. Add CSSetVettedGateTree factory to EasyTrack with permissions ❌ NOT COVERED
# 68. Add `SubmitValidatorsExitRequestHashes` (SDVT) EVM script factory to Easy Track ❌ NOT COVERED
# 69. Add `SubmitValidatorsExitRequestHashes` (Curated Module) EVM script factory to Easy Track ❌ NOT COVERED

---
parameters:
  - &lidoLocator "0xC1d0b3DE6792Bf6b4b37EccdcC24e45978Cfd2Eb"
  - &lido "0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84"
  - &stakingRouter "0xFdDf38947aFB03C621C71b06C9C70bce73f12999"
  - &accountingOracle "0x852deD011285fe67063a08005c71a85690503Cee"
  - &agent "0x3e40D73EB977Dc6a537aF587D48316feE66E9C8c"
  - &treasury "0x3e40D73EB977Dc6a537aF587D48316feE66E9C8c"
  - &elRewardsVault "0x388C818CA8B9251b393131C08a736A67ccB19297"
  - &legacyOracle "0x442af784A788A5bd6F42A01Ebe9F287a871243fb"
  - &burner "0xD15a672319Cf0352560eE76d9e89eAB0889046D3"
  - &withdrawalQueue "0x889edC2eDab5f40e902b864aD4d7AdE8E412F9B1"
  - &withdrawalVault "0xB9D7934878B5FB9610B3fE8A5e441e8fad7E293f"
  - &oracleDaemonConfig "0xbf05A929c3D7885a6aeAd833a992dA6E5ac23b09"
  - &postTokenRebaseReceiver "0xe6793B9e4FbA7DE0ee833F9D02bba7DB5EB27823"
  - &DEPOSIT_CONTRACT "0x00000000219ab540356cBB839Cbe05303d7705Fa"
  - &validatorsExitBusOracle "0x0De4Ea0184c2ad0BacA7183356Aea5B8d5Bf5c6e"
  - &oracleReportSanityChecker "0x6232397ebac4f5772e53285B26c47914E9461E75"
  - &depositSecurityModule "0xfFA96D84dEF2EA035c7AB153D8B991128e3d72fD"
  - &contract7002 "0x00000961Ef480Eb55e80D19ad83579A64c007002"
  - &gateSealCommittee "0x8772E3a2D86B9347A2688f9bc1808A6d8917760C"
  - &nodeOperatorsRegistry "0x55032650b14df07b85bF18A3a3eC8E0Af2e028d5"
  - &simpleDVT "0xaE7B191A31f627b4eB1d4DaC64eaB9976995b433"

  # TW voting specific contracts
  - &triggerableWithdrawalsGateway "0xDC00116a0D3E064427dA2600449cfD2566B3037B"
  - &validatorExitDelayVerifier "0xbDb567672c867DB533119C2dcD4FB9d8b44EC82f"
  - &csEjector "0xc72b58aa02E0e98cF8A4a0E9Dce75e763800802C"

  # Gate seals
  - &oldGateSeal "0xf9C9fDB4A5D2AA1D836D5370AB9b28BC1847e178"
  - &newWqGateSeal "0x8A854C4E750CDf24f138f34A9061b2f556066912"
  - &newTwGateSeal "0xA6BC802fAa064414AA62117B4a53D27fFfF741F1"
  - &resealManager "0x7914b5a1539b97Bd0bbd155757F25FD79A522d24"

  # EasyTrack
  - &easyTrackEvmScriptExecutor "0xFE5986E06210aC1eCC1aDCafc0cc7f8D63B3F977"

misc:
  - &stakingModuleCuratedType "0x637572617465642d6f6e636861696e2d76310000000000000000000000000000"

deployed:
  l1:
    # Item 1: Lido Locator implementation
    - &lidoLocatorImpl "0x2C298963FB763f74765829722a1ebe0784f4F5Cf"
    # Item 13: Accounting Oracle implementation
    - &accountingOracleImpl "0xE9906E543274cebcd335d2C560094089e9547e8d"
    # Item 2: VEBO implementation
    - &validatorExitBusOracleImpl "0x905A211eD6830Cfc95643f0bE2ff64E7f3bf9b94"
    # Item 11: Withdrawal Vault implementation
    - &withdrawalVaultImpl "0x7D2BAa6094E1C4B60Da4cbAF4A77C3f4694fD53D"
    # Item 18: Staking Router implementation
    - &stakingRouterImpl "0x226f9265CBC37231882b7409658C18bB7738173A"
    # Item 23: Node Operators Registry implementation
    - &nodeOperatorRegistryImpl "0x6828b023e737f96B168aCd0b5c6351971a4F81aE"

roles:
  - &DEFAULT_ADMIN_ROLE "0x0000000000000000000000000000000000000000000000000000000000000000"
  - &STAKING_MODULE_UNVETTING_ROLE "0x240525496a9dc32284b17ce03b43e539e4bd81414634ee54395030d793463b57"
  - &STAKING_ROUTER_ROLE "0xbb75b874360e0bfd87f964eadd8276d8efb7c942134fc329b513032d0803e0c6"
  - &REPORT_VALIDATOR_EXITING_STATUS_ROLE "0xbe1bd143a0dde8a867d58aab054bfdb25250951665c4570e39abc3b3de3c2d6c"
  - &REPORT_VALIDATOR_EXIT_TRIGGERED_ROLE "0x0766e72e5c008b3df8129fb356d9176eef8544f6241e078b7d61aff604f8812b"
  - &EXIT_REQUEST_LIMIT_MANAGER_ROLE "0x9c616dd118785b2e2fccf45a4ff151a335ff7b6a84cd1c4d7fd9f97f39ea9342"
  - &MANAGE_CONSENSUS_CONTRACT_ROLE "0x04a0afbbd09d5ad397fc858789da4f8edd59f5ca5098d70faa490babee945c3b"
  - &MANAGE_CONSENSUS_VERSION_ROLE "0xc31b1e4b732c5173dc51d519dfa432bad95550ecc4b0f9a61c2a558a2a8e4341"
  - &PAUSE_ROLE "0x139c2898040ef16910dc9f44dc697df79363da767d8bc92f2e310312b816e46d"
  - &RESUME_ROLE "0x2fc10cc8ae19568712f7a176fb4978616a610650813c9d05326c34abb62749c7"
  - &SUBMIT_DATA_ROLE "0x65fa0c17458517c727737e4153dd477fa3e328cf706640b0f68b1a285c5990da"
  - &SUBMIT_REPORT_HASH_ROLE "0x22ebb4dbafb72948800c1e1afa1688772a1a4cfc54d5ebfcec8163b1139c082e"
  - &ADD_FULL_WITHDRAWAL_REQUEST_ROLE "0x15fac8ba7fe8dd5344b88c1915452ce66976f270d1cd793c3b0ab579cecd33c0"
  - &TW_EXIT_LIMIT_MANAGER_ROLE "0x03c30da9b9e4d4789ac88a294d39a63058ca4a498804c2aa823e381df59d0cf4"
  - &CONFIG_MANAGER_ROLE "0xbbfb55d933c2bfa638763473275b1d84c4418e58d26cf9d2cd5758237756d9f0"

l1:
  rpcUrl: L1_MAINNET_RPC_URL
  contracts:
    # Item 1: Update locator implementation
    lidoLocator:
      name: LidoLocator
      address: *lidoLocator
      proxyName: OssifiableProxy
      implementation: *lidoLocatorImpl
      proxyChecks:
        proxy__getImplementation: *lidoLocatorImpl
        proxy__getAdmin: *agent
        proxy__getIsOssified: false
      checks:
        accountingOracle: *accountingOracle
        burner: *burner
        coreComponents: [*elRewardsVault, *oracleReportSanityChecker, *stakingRouter, *treasury, *withdrawalQueue, *withdrawalVault]
        depositSecurityModule: *depositSecurityModule
        elRewardsVault: *elRewardsVault
        legacyOracle: *legacyOracle
        lido: *lido
        oracleDaemonConfig: *oracleDaemonConfig
        oracleReportComponentsForLido: null
        oracleReportSanityChecker: *oracleReportSanityChecker
        postTokenRebaseReceiver: *postTokenRebaseReceiver
        stakingRouter: *stakingRouter
        treasury: *treasury
        validatorsExitBusOracle: *validatorsExitBusOracle
        withdrawalQueue: *withdrawalQueue
        withdrawalVault: *withdrawalVault
        validatorExitDelayVerifier: *validatorExitDelayVerifier
        triggerableWithdrawalsGateway: *triggerableWithdrawalsGateway

    # Item 18: Update SR implementation
    stakingRouter:
      name: StakingRouter
      address: *stakingRouter
      proxyName: OssifiableProxy
      implementation: *stakingRouterImpl
      proxyChecks:
        proxy__getImplementation: *stakingRouterImpl
        proxy__getAdmin: *agent
        proxy__getIsOssified: false
      checks:
        DEFAULT_ADMIN_ROLE: *DEFAULT_ADMIN_ROLE
        DEPOSIT_CONTRACT: *DEPOSIT_CONTRACT
        # Item 20: Grant SR role REPORT_VALIDATOR_EXITING_STATUS_ROLE to ValidatorExitDelayVerifier
        REPORT_VALIDATOR_EXITING_STATUS_ROLE: *REPORT_VALIDATOR_EXITING_STATUS_ROLE
        # Item 21: Grant SR role REPORT_VALIDATOR_EXIT_TRIGGERED_ROLE to TWG
        REPORT_VALIDATOR_EXIT_TRIGGERED_ROLE: *REPORT_VALIDATOR_EXIT_TRIGGERED_ROLE
        FEE_PRECISION_POINTS: 100000000000000000000
        MANAGE_WITHDRAWAL_CREDENTIALS_ROLE: "0xe7c742a54cd11fc9749a47ab34bdcd7327820908e8d0d48b4a5c7f17b0294098"
        MAX_STAKING_MODULES_COUNT: 32
        MAX_STAKING_MODULE_NAME_LENGTH: 31
        REPORT_EXITED_VALIDATORS_ROLE: "0xc23292b191d95d2a7dd94fc6436eb44338fda9e1307d9394fd27c28157c1b33c"
        REPORT_REWARDS_MINTED_ROLE: "0x779e5c23cb7a5bcb9bfe1e9a5165a00057f12bcdfd13e374540fdf1a1cd91137"
        STAKING_MODULE_MANAGE_ROLE: "0x3105bcbf19d4417b73ae0e58d508a65ecf75665e46c2622d8521732de6080c48"
        STAKING_MODULE_UNVETTING_ROLE: "0x240525496a9dc32284b17ce03b43e539e4bd81414634ee54395030d793463b57"
        TOTAL_BASIS_POINTS: 10000
        UNSAFE_SET_EXITED_VALIDATORS_ROLE: "0x55180e25fcacf9af017d35d497765476319b23896daa1f9bc2b38fa80b36a163"
        getAllNodeOperatorDigests: null
        getAllStakingModuleDigests: null
        # Item 19: Call finalizeUpgrade_v3() on SR
        getContractVersion: 3
        getDepositsAllocation: null
        getLido: *lido
        getNodeOperatorDigests: null
        getNodeOperatorSummary: null
        getRoleAdmin: null
        getRoleMember: null
        getRoleMemberCount:
          - args: [ *STAKING_MODULE_UNVETTING_ROLE ]
            result: 1
          - args: [ *DEFAULT_ADMIN_ROLE ]
            result: 1
          # Item 20: Check role granted
          - args: [ *REPORT_VALIDATOR_EXITING_STATUS_ROLE ]
            result: 1
          # Item 21: Check role granted
          - args: [ *REPORT_VALIDATOR_EXIT_TRIGGERED_ROLE ]
            result: 1
        getStakingFeeAggregateDistribution: null
        getStakingFeeAggregateDistributionE4Precision: null
        getStakingModule: null
        getStakingModuleActiveValidatorsCount: null
        getStakingModuleDigests: null
        getStakingModuleIds: null
        getStakingModuleIsActive: null
        getStakingModuleIsDepositsPaused: null
        getStakingModuleIsStopped: null
        getStakingModuleLastDepositBlock: null
        getStakingModuleMaxDepositsCount: null
        getStakingModuleMaxDepositsPerBlock: null
        getStakingModuleMinDepositBlockDistance: null
        getStakingModuleNonce: null
        getStakingModuleStatus: null
        getStakingModuleSummary: null
        getStakingModules: null
        getStakingModulesCount: null
        getStakingRewardsDistribution: null
        getTotalFeeE4Precision: null
        getWithdrawalCredentials: "0x010000000000000000000000b9d7934878b5fb9610b3fe8a5e441e8fad7e293f"
        hasRole:
          # Item 20: Verify role granted to ValidatorExitDelayVerifier
          - args: [ *REPORT_VALIDATOR_EXITING_STATUS_ROLE, *validatorExitDelayVerifier ]
            result: true
          # Item 21: Verify role granted to TWG
          - args: [ *REPORT_VALIDATOR_EXIT_TRIGGERED_ROLE, *triggerableWithdrawalsGateway ]
            result: true
        hasStakingModule: null
        supportsInterface: null

    # Item 23: Update NodeOperatorsRegistry implementation
    nodeOperatorsRegistry:
      name: NodeOperatorsRegistry
      address: *nodeOperatorsRegistry
      proxyName: AppProxyUpgradeable
      implementation: *nodeOperatorRegistryImpl
      proxyChecks:
        proxyType: null
        isDepositable: null
        implementation: *nodeOperatorRegistryImpl
        appId: null
        kernel: null
      checks:
        proxyType: null
        isDepositable: null
        implementation: null
        MANAGE_NODE_OPERATOR_ROLE: "0x78523850fdd761612f46e844cf5a16bda6b3151d6ae961fd7e8e7b92bfbca7f8"
        MANAGE_SIGNING_KEYS: "0x75abc64490e17b40ea1e66691c3eb493647b24430b358bd87ec3e5127f1621ee"
        MAX_NODE_OPERATORS_COUNT: 200
        MAX_NODE_OPERATOR_NAME_LENGTH: 255
        MAX_STUCK_PENALTY_DELAY: 31536000
        SET_NODE_OPERATOR_LIMIT_ROLE: "0x07b39e0faf2521001ae4e58cb9ffd3840a63e205d288dc9c93c3774f0d794754"
        STAKING_ROUTER_ROLE: *STAKING_ROUTER_ROLE
        appId: null
        allowRecoverability: null
        canPerform: null
        getActiveNodeOperatorsCount: null
        # Item 24: Call finalizeUpgrade_v4 on Curated Staking Module
        getContractVersion: 4
        getEVMScriptExecutor: null
        getEVMScriptRegistry: null
        getInitializationBlock: null
        getKeysOpIndex: null
        getLocator: null
        getNodeOperator: null
        getNodeOperatorIds: null
        getNodeOperatorIsActive: null
        getNodeOperatorSummary: null
        getNodeOperatorsCount: null
        getNonce: null
        getRecoveryVault: null
        getRewardDistributionState: null
        getRewardsDistribution: null
        getSigningKey: null
        getSigningKeys: null
        getStakingModuleSummary: null
        getStuckPenaltyDelay: 0
        getTotalSigningKeyCount: null
        getType: "0x637572617465642d6f6e636861696e2d76310000000000000000000000000000"
        getUnusedSigningKeyCount: null
        hasInitialized: null
        isOperatorPenalized:
          - args: [ 1 ]
            result: false
        isOperatorPenaltyCleared:
          - args: [ 1 ]
            result: true
        exitDeadlineThreshold:
          - args: [ 1 ]
            result: 172800  # NOR_EXIT_DEADLINE_IN_SEC from voting script
        isValidatorExitingKeyReported:
          - args: [ "0x95F00b016bB31b7182D96D25074684518246E42a" ]
            result: false
        isPetrified: null
        kernel: null
        isValidatorExitDelayPenaltyApplicable: null
        exitPenaltyCutoffTimestamp: 1759150801  # Warning! Vote enactment minus 4 days on mainnet

    # Item 25: Update SimpleDVT implementation
    simpleDVT:
      name: SimpleDVT
      address: *simpleDVT
      proxyName: AppProxyUpgradeable
      implementation: *nodeOperatorRegistryImpl
      proxyChecks:
        proxyType: null
        isDepositable: null
        implementation: *nodeOperatorRegistryImpl
        appId: null
        kernel: null
      checks:
        proxyType: null
        isDepositable: null
        implementation: null
        MANAGE_NODE_OPERATOR_ROLE: null
        MANAGE_SIGNING_KEYS: null
        MAX_NODE_OPERATORS_COUNT: null
        MAX_NODE_OPERATOR_NAME_LENGTH: null
        MAX_STUCK_PENALTY_DELAY: null
        SET_NODE_OPERATOR_LIMIT_ROLE: null
        STAKING_ROUTER_ROLE: *STAKING_ROUTER_ROLE
        appId: null
        allowRecoverability: null
        canPerform: null
        getActiveNodeOperatorsCount: null
        # Item 26: Call finalizeUpgrade_v4 on sDVT
        getContractVersion: 4
        getEVMScriptExecutor: null
        getEVMScriptRegistry: null
        getInitializationBlock: null
        getKeysOpIndex: null
        getLocator: *lidoLocator
        getNodeOperator: null
        getNodeOperatorIds: null
        getNodeOperatorIsActive: null
        getNodeOperatorSummary: null
        getNodeOperatorsCount: null
        getNonce: null
        getRecoveryVault: null
        getRewardDistributionState: null
        getRewardsDistribution: null
        getSigningKey: null
        getSigningKeys: null
        getStakingModuleSummary: null
        getStuckPenaltyDelay: null
        getTotalSigningKeyCount: null
        getType: *stakingModuleCuratedType
        getUnusedSigningKeyCount: null
        hasInitialized: null
        isOperatorPenalized: null
        isOperatorPenaltyCleared: null
        exitDeadlineThreshold:
          - args: [ 1 ]
            result: 172800  # NOR_EXIT_DEADLINE_IN_SEC from voting script
        isValidatorExitingKeyReported: null
        isPetrified: null
        kernel: null
        isValidatorExitDelayPenaltyApplicable: null
        exitPenaltyCutoffTimestamp: 1759150801  # Warning! Vote enactment minus 4 days on mainnet

    # Item 13: Update Accounting Oracle implementation
    accountingOracle:
      name: AccountingOracle
      address: *accountingOracle
      proxyName: OssifiableProxy
      implementation: *accountingOracleImpl
      proxyChecks:
        proxy__getImplementation: *accountingOracleImpl
        proxy__getAdmin: *agent
        proxy__getIsOssified: false
      checks:
        DEFAULT_ADMIN_ROLE: *DEFAULT_ADMIN_ROLE
        EXTRA_DATA_FORMAT_EMPTY: 0
        EXTRA_DATA_FORMAT_LIST: 1
        EXTRA_DATA_TYPE_EXITED_VALIDATORS: 2
        EXTRA_DATA_TYPE_STUCK_VALIDATORS: 1
        GENESIS_TIME: 1606824023
        LEGACY_ORACLE: *legacyOracle
        LIDO: *lido
        LOCATOR: *lidoLocator
        MANAGE_CONSENSUS_CONTRACT_ROLE: "0x04a0afbbd09d5ad397fc858789da4f8edd59f5ca5098d70faa490babee945c3b"
        MANAGE_CONSENSUS_VERSION_ROLE: "0xc31b1e4b732c5173dc51d519dfa432bad95550ecc4b0f9a61c2a558a2a8e4341"
        SECONDS_PER_SLOT: 12
        SUBMIT_DATA_ROLE: *SUBMIT_DATA_ROLE
        getConsensusContract: "0xD624B08C83bAECF0807Dd2c6880C3154a5F0B288"
        getConsensusReport: null
        # Item 15: Bump AO consensus version to 4
        getConsensusVersion: 4
        # Item 17: Call finalizeUpgrade_v3() on AO
        getContractVersion: 3
        getLastProcessingRefSlot: null
        getProcessingState: null
        getRoleAdmin: null
        getRoleMember: null
        getRoleMemberCount:
          # Item 14 & 16: Verify MANAGE_CONSENSUS_VERSION_ROLE revoked from AGENT
          - args: [ *MANAGE_CONSENSUS_VERSION_ROLE ]
            result: 0
        hasRole:
          # Item 14 & 16: Verify MANAGE_CONSENSUS_VERSION_ROLE revoked from AGENT
          - args: [ *MANAGE_CONSENSUS_VERSION_ROLE, *agent ]
            result: false
        supportsInterface: null

    # Item 2: Update VEBO implementation
    validatorsExitBusOracle:
      name: ValidatorsExitBusOracle
      address: *validatorsExitBusOracle
      proxyName: OssifiableProxy
      implementation: *validatorExitBusOracleImpl
      proxyChecks:
        proxy__getImplementation: *validatorExitBusOracleImpl
        proxy__getAdmin: *agent
        proxy__getIsOssified: false
      checks:
        DEFAULT_ADMIN_ROLE: *DEFAULT_ADMIN_ROLE
        DATA_FORMAT_LIST: 1
        EXIT_REQUEST_LIMIT_MANAGER_ROLE: *EXIT_REQUEST_LIMIT_MANAGER_ROLE
        EXIT_TYPE: 2
        GENESIS_TIME: 1606824023
        MANAGE_CONSENSUS_CONTRACT_ROLE: *MANAGE_CONSENSUS_CONTRACT_ROLE
        MANAGE_CONSENSUS_VERSION_ROLE: *MANAGE_CONSENSUS_VERSION_ROLE
        PAUSE_INFINITELY: 115792089237316195423570985008687907853269984665640564039457584007913129639935
        PAUSE_ROLE: *PAUSE_ROLE
        RESUME_ROLE: *RESUME_ROLE
        SECONDS_PER_SLOT: 12
        SUBMIT_DATA_ROLE: *SUBMIT_DATA_ROLE
        SUBMIT_REPORT_HASH_ROLE: *SUBMIT_REPORT_HASH_ROLE
        getConsensusContract: null
        getConsensusReport: null
        # Item 5: Bump VEBO consensus version to 4
        getConsensusVersion: 4
        # Item 3: Call finalizeUpgrade_v2 on VEBO
        getContractVersion: 2
        getDeliveryTimestamp: null
        getExitRequestLimitFullInfo: null
        getLastProcessingRefSlot: null
        # Item 3: Verify finalizeUpgrade_v2 parameters
        getMaxValidatorsPerReport: 600  # MAX_VALIDATORS_PER_REPORT
        getProcessingState: null
        getResumeSinceTimestamp: null
        getRoleAdmin: null
        getRoleMember: null
        getRoleMemberCount:
          # Item 4 & 6: Verify MANAGE_CONSENSUS_VERSION_ROLE revoked from AGENT
          - args: [ *MANAGE_CONSENSUS_VERSION_ROLE ]
            result: 0
          # Item 7: Verify SUBMIT_REPORT_HASH_ROLE granted to EasyTrack EVM Script Executor
          - args: [ *SUBMIT_REPORT_HASH_ROLE ]
            result: 1
          # Item 61, 63: Verify PAUSE_ROLE changes (new TW GateSeal + ResealManager)
          - args: [ *PAUSE_ROLE ]
            result: 2
        getTotalRequestsProcessed: null
        hasRole:
          # Item 4 & 6: Verify MANAGE_CONSENSUS_VERSION_ROLE revoked from AGENT
          - args: [ *MANAGE_CONSENSUS_VERSION_ROLE, *agent ]
            result: false
          # Item 7: Verify SUBMIT_REPORT_HASH_ROLE granted to EasyTrack EVM Script Executor
          - args: [ *SUBMIT_REPORT_HASH_ROLE, *easyTrackEvmScriptExecutor ]
            result: true
          # Item 61: Verify PAUSE_ROLE revoked from old GateSeal
          - args: [ *PAUSE_ROLE, *oldGateSeal ]
            result: false
          # Item 63: Verify PAUSE_ROLE granted to new Triggerable Withdrawals GateSeal
          - args: [ *PAUSE_ROLE, *newTwGateSeal ]
            result: true
        isPaused: null
        supportsInterface: null
        unpackExitRequest: null

    # Item 11: Update WithdrawalVault implementation
    withdrawalVault:
      name: WithdrawalVault
      address: *withdrawalVault
      proxyName: WithdrawalContractProxy
      implementation: *withdrawalVaultImpl
      proxyChecks:
        proxy_getAdmin: *agent
        implementation: *withdrawalVaultImpl
        proxy_getIsOssified: null
      checks:
        LIDO: *lido
        TREASURY: *treasury
        TRIGGERABLE_WITHDRAWALS_GATEWAY: *triggerableWithdrawalsGateway
        WITHDRAWAL_REQUEST: *contract7002
        # Item 12: Call finalizeUpgrade_v2() on WithdrawalVault
        getContractVersion: 2
        getWithdrawalRequestFee: null

    validatorExitDelayVerifier:
      name: ValidatorExitDelayVerifier
      address: *validatorExitDelayVerifier
      checks:
        BEACON_ROOTS: "0x000F3df6D732807Ef1319fB7B8bB8522d0Beac02"
        CAPELLA_SLOT: "6209536"
        FIRST_SUPPORTED_SLOT: "11649024"
        GENESIS_TIME: "1606824023"
        GI_FIRST_BLOCK_ROOT_IN_SUMMARY_CURR: "0x000000000000000000000000000000000000000000000000000000000040000d"
        GI_FIRST_BLOCK_ROOT_IN_SUMMARY_PREV: "0x000000000000000000000000000000000000000000000000000000000040000d"
        GI_FIRST_HISTORICAL_SUMMARY_CURR: "0x000000000000000000000000000000000000000000000000000000b600000018"
        GI_FIRST_HISTORICAL_SUMMARY_PREV: "0x000000000000000000000000000000000000000000000000000000b600000018"
        GI_FIRST_VALIDATOR_CURR: "0x0000000000000000000000000000000000000000000000000096000000000028"
        GI_FIRST_VALIDATOR_PREV: "0x0000000000000000000000000000000000000000000000000096000000000028"
        LOCATOR: *lidoLocator
        PIVOT_SLOT: 11649024
        SECONDS_PER_SLOT: 12
        SHARD_COMMITTEE_PERIOD_IN_SECONDS: 98304
        SLOTS_PER_EPOCH: 32
        SLOTS_PER_HISTORICAL_ROOT: 8192

    # Items 8-9, 64-66: Triggerable Withdrawals Gateway
    triggerableWithdrawalsGateway:
      name: TriggerableWithdrawalsGateway
      address: *triggerableWithdrawalsGateway
      checks:
        ADD_FULL_WITHDRAWAL_REQUEST_ROLE: *ADD_FULL_WITHDRAWAL_REQUEST_ROLE
        DEFAULT_ADMIN_ROLE: *DEFAULT_ADMIN_ROLE
        PAUSE_INFINITELY: 115792089237316195423570985008687907853269984665640564039457584007913129639935
        PAUSE_ROLE: *PAUSE_ROLE
        RESUME_ROLE: *RESUME_ROLE
        TWR_LIMIT_POSITION: null
        TW_EXIT_LIMIT_MANAGER_ROLE: *TW_EXIT_LIMIT_MANAGER_ROLE
        VERSION: 1
        # Item 3: Verify finalizeUpgrade_v2 parameters on VEBO affect TWG
        getExitRequestLimitFullInfo: [11200,1,48,11200,11200]
        getResumeSinceTimestamp: 0
        getRoleAdmin: null
        getRoleMember:
          - args: [ *DEFAULT_ADMIN_ROLE, 0 ]
            result: *agent
        getRoleMemberCount:
          - args: [ *DEFAULT_ADMIN_ROLE ]
            result: 1
          # Item 8: Verify ADD_FULL_WITHDRAWAL_REQUEST_ROLE granted to CS Ejector
          - args: [ *ADD_FULL_WITHDRAWAL_REQUEST_ROLE ]
            result: 2
          # Item 64-66: Verify PAUSE_ROLE and RESUME_ROLE changes
          - args: [ *PAUSE_ROLE ]
            result: 2
          - args: [ *RESUME_ROLE ]
            result: 1
        hasRole:
          # Item 8: Verify ADD_FULL_WITHDRAWAL_REQUEST_ROLE granted to CS Ejector
          - args: [ *ADD_FULL_WITHDRAWAL_REQUEST_ROLE, *csEjector ]
            result: true
          # Item 9: Verify ADD_FULL_WITHDRAWAL_REQUEST_ROLE granted to VEB
          - args: [ *ADD_FULL_WITHDRAWAL_REQUEST_ROLE, *validatorsExitBusOracle ]
            result: true
          # Item 64: Verify PAUSE_ROLE granted to new Triggerable Withdrawals GateSeal
          - args: [ *PAUSE_ROLE, *newTwGateSeal ]
            result: true
          # Item 65: Verify PAUSE_ROLE granted to ResealManager
          - args: [ *PAUSE_ROLE, *resealManager ]
            result: true
          # Item 66: Verify RESUME_ROLE granted to ResealManager
          - args: [ *RESUME_ROLE, *resealManager ]
            result: true
        isPaused: false
        supportsInterface: null

    # Item 62: WithdrawalQueue GateSeal changes
    wqGateSeal:
      name: WqGateSeal
      address: *newWqGateSeal
      checks:
        get_sealing_committee: *gateSealCommittee
        get_seal_duration_seconds: 1209600
        get_sealables: [*withdrawalQueue]
        get_expiry_timestamp: 1789207187
        is_expired: false

    # Item 63-64: Triggerable Withdrawals GateSeal
    twGateSeal:
      name: TwGateSeal
      address: *newTwGateSeal
      checks:
        get_sealing_committee: *gateSealCommittee
        get_seal_duration_seconds: 1209600
        get_sealables: [*triggerableWithdrawalsGateway, *validatorsExitBusOracle]
        get_expiry_timestamp: 1789207187
        is_expired: false

    # Item 60, 62: WithdrawalQueue role changes
    withdrawalQueue:
      name: WithdrawalQueue
      address: *withdrawalQueue
      checks:
        BUNKER_MODE_DISABLED_TIMESTAMP: null
        DEFAULT_ADMIN_ROLE: null
        FINALIZE_ROLE: null
        MANAGE_TOKEN_URI_ROLE: null
        MAX_BATCHES_LENGTH: null
        MAX_STETH_WITHDRAWAL_AMOUNT: null
        MIN_STETH_WITHDRAWAL_AMOUNT: null
        ORACLE_ROLE: null
        PAUSE_INFINITELY: null
        PAUSE_ROLE: null
        RESUME_ROLE: null
        STETH: null
        WSTETH: null
        balanceOf: null
        bunkerModeSinceTimestamp: null
        calculateFinalizationBatches: null
        findCheckpointHints: null
        getApproved: null
        getBaseURI: null
        getClaimableEther: null
        getContractVersion: null
        getLastCheckpointIndex: null
        getLastFinalizedRequestId: null
        getLastRequestId: null
        getLockedEtherAmount: null
        getNFTDescriptorAddress: null
        getResumeSinceTimestamp: null
        getRoleAdmin: null
        getRoleMember: null
        getWithdrawalRequests: null
        getWithdrawalStatus: null
        isApprovedForAll: null
        isBunkerModeActive: null
        isPaused: null
        name: null
        ownerOf: null
        prefinalize: null
        supportsInterface: null
        symbol: null
        tokenURI: null
        unfinalizedRequestNumber: null
        unfinalizedStETH: null
        getRoleMemberCount:
          # Item 60, 62: Verify PAUSE_ROLE changes (expecting 2 due to both old and new GateSeals)
          - args: [ *PAUSE_ROLE ]
            result: 2
        hasRole:
          # Item 60: Verify PAUSE_ROLE revoked from old GateSeal
          - args: [ *PAUSE_ROLE, *oldGateSeal ]
            result: false
          # Item 62: Verify PAUSE_ROLE granted to new WithdrawalQueue GateSeal
          - args: [ *PAUSE_ROLE, *newWqGateSeal ]
            result: true

    # Item 28, 33: Oracle daemon config role management
    oracleDaemonConfig:
      name: OracleDaemonConfig
      address: *oracleDaemonConfig
      checks:
        CONFIG_MANAGER_ROLE: null
        DEFAULT_ADMIN_ROLE: null
        get:
          # Item 32: Verify EXIT_EVENTS_LOOKBACK_WINDOW_IN_SLOTS variable added
          - args: [ "EXIT_EVENTS_LOOKBACK_WINDOW_IN_SLOTS" ]
            result: "0x0189c0"  # 100800 = 14 * 7200 (14 days in slots)
        getList: null
        getRoleAdmin: null
        getRoleMember: null
        supportsInterface: null
        getRoleMemberCount:
          # Item 28 & 33: Verify CONFIG_MANAGER_ROLE revoked from AGENT
          - args: [ *CONFIG_MANAGER_ROLE ]
            result: 0
        hasRole:
          # Item 28 & 33: Verify CONFIG_MANAGER_ROLE revoked from AGENT
          - args: [ *CONFIG_MANAGER_ROLE, *agent ]
            result: false
